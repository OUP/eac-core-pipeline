---
version: 0.2
phases:
  install:
    runtime-versions:
      python: latest
  pre_build:
    commands:
      - export AMI_ID=$(cat eac-core/packer/ami_id.txt)
      - echo "${AMI_ID}"
      - echo "Installing Ansible & adding to PATH ..."
      - python -m pip install --user ansible
      - echo "$PATH"
      - export PATH=$PATH:/usr/bin/ansible-playbook
      - echo "$PATH"
      - cd eac-core/
      - cd packer/
      - echo "Validating Packer template ..."
      - ./packer validate packer_test.json
  build:
    commands:
      # - echo "Running build for packer ..."
      # - ./packer build -color=false -parallel-builds=1 -timestamp-ui packer_test.json | tee build.log
  post_build:
    commands:
      # - cat ami_builder_event.json
      - echo "test completed on `date`"