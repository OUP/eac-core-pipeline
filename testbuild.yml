---
version: 0.2
phases:
  pre_build:
    commands:
      # - echo "/${UPSTREAMSTACK}/${ENVIRONMENT}/${GOLDENAMIPIPELINE}"
      # - export GOLDEN_AMI_ID=$(aws ssm get-parameters --name "/${UPSTREAMSTACK}/${ENVIRONMENT}/${GOLDENAMIPIPELINE}" --query "Parameters[0].Value" --output text)
      # - echo "${GOLDEN_AMI_ID}"
      - ls -la
      - cd eac-core/
      - cd packer/
      - echo "Installing Packer"
      - curl -o packer.zip https://releases.hashicorp.com/packer/1.5.1/packer_1.5.1_linux_amd64.zip && unzip packer.zip
      - cd ../../
      # - cp -r build/ eac-core/packer/
      # - cd eac-core/
      # - cd packer/
      - echo "Validating Packer template"
      - ./packer validate packer.json # Change packer.json name
  build:
    commands:
      # - echo "copy dependencies into place"
      - echo "running build for packer"
      # - ./packer build -color=false -parallel=false -timestamp-ui packer.json | tee build.log # Change packer.json name
  post_build:
    commands:
      # - cat ami_builder_event.json
      - echo "test completed on `date`"